# BRO 予約システム ドメインモデル定義
（03_domain_model.md）

## 1. 本ドキュメントの目的

本ドキュメントは、BRO予約システムにおける  
**主要なドメイン（概念）・エンティティ・責務の整理**を目的とする。

- データ構造のブレを防ぐ
- 機能追加時の判断基準を明確にする
- 実装とビジネス要件のズレを防ぐ

---

## 2. ドメイン全体像（MVP）

BRO予約システムは以下のドメインで構成される。

Customer（顧客）  
↓  
Reservation（予約）  
↑  
Staff（ボーイ）  
↑  
Availability（出勤・空き枠）

---

## 3. エンティティ定義

### 3.1 Customer（顧客）

#### 概要
予約を行うユーザー。  
MVPでは「会員登録なし」前提。

#### 主な属性
- id：顧客ID（将来用・nullable）
- name：表示名（仮名可）
- email：メールアドレス
- tel：電話番号

#### 備考
- MVPでは Reservation に直接埋め込み
- 将来リピーター対応で独立予定

---

### 3.2 Staff（ボーイ）

#### 概要
予約を受けるスタッフ。

#### 主な属性
- id：スタッフID
- name：表示名
- is_active：稼働中フラグ
- role：staff / admin

#### 備考
- 管理者も Staff として扱う
- HPプロフィールとは疎結合

---

### 3.3 Availability（出勤・空き枠）

#### 概要
スタッフが予約を受け付け可能な時間帯。

#### 主な属性
- id：空き枠ID
- staff_id：スタッフID
- date：日付
- start_time：開始時刻
- end_time：終了時刻

#### 責務
- 予約可能時間の上限を定義
- Reservation は必ずこの範囲内

---

### 3.4 Reservation（予約）

#### 概要
お客様からの予約問い合わせ・確定情報。

#### 主な属性
- id：予約ID
- staff：スタッフ名（MVPは文字列）
- date：予約日
- time：開始時刻
- course：コース時間
- name：顧客名
- tel：電話番号
- email：メール
- status：pending / approved / canceled
- note：その他要望

#### ステータス定義
- pending：未承認（問い合わせ）
- approved：承認済み（確定）
- canceled：キャンセル

---

## 4. ドメインルール

### 4.1 Availability 優先ルール
- Availability が存在しない時間は予約不可
- 予約は必ず Availability 内に収まる

### 4.2 予約の2段階構造
1. 作成時：pending
2. 承認後：approved

※ 作成時点では確定ではない

### 4.3 二重予約禁止
- approved が存在する時間帯は使用不可
- pending は将来ルール検討

---

## 5. 空き枠制御の前提

- 「開始時刻 × コース時間」で可否判定
- コース時間確定後に予約可能枠を算出
- UX矛盾を防ぐため順序を厳守

---

## 6. MVPで扱わない項目

- 決済処理
- 会員ログイン
- 自動キャンセル
- メール自動送信

---

## 7. 設計方針

- 拡張前提で冗長を許容
- page.tsx は薄く保つ
- ロジックは責務ごとに分離

---

## 8. 更新ルール

- ドメイン変更時は本ドキュメント更新
- 実装と乖離した場合は本ドキュメントを正とする
